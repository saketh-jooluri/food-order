Kubernetes Deployment:
    apiVersion: apps/v1
    kind: Deployment
    metadata:
    name: payment-service
    namespace: foodorder
    spec:
    replicas: 2
    selector:
        matchLabels:
        app: payment-service
    template:
        metadata:
        labels:
            app: payment-service
        annotations:
            prometheus.io/scrape: "true"
            prometheus.io/port: "3003"
            prometheus.io/path: "/metrics"
        spec:
        serviceAccountName: payment-service
        containers:
            - name: payment-service
            image: docker.io/your-registry/payment-service:latest
            ports:
                - name: http
                containerPort: 3003
            env:
                - name: NODE_ENV
                value: "production"
                - name: PORT
                value: "3003"
                - name: DB_HOST
                valueFrom:
                    secretKeyRef:
                    name: db-credentials
                    key: host
                - name: DB_PASSWORD
                valueFrom:
                    secretKeyRef:
                    name: db-credentials
                    key: password
                - name: REDIS_HOST
                value: "redis:6379"
                - name: JWT_SECRET
                valueFrom:
                    secretKeyRef:
                    name: jwt-secret
                    key: secret
            resources:
                requests:
                cpu: "100m"
                memory: "128Mi"
                limits:
                cpu: "500m"
                memory: "512Mi"
            livenessProbe:
                httpGet:
                path: /health
                port: http
                initialDelaySeconds: 30
                periodSeconds: 10
            readinessProbe:
                httpGet:
                path: /health
                port: http
                initialDelaySeconds: 10
                periodSeconds: 5
    ---
    apiVersion: v1
    kind: Service
    metadata:
    name: payment-service
    namespace: foodorder
    spec:
    type: ClusterIP
    selector:
        app: payment-service
    ports:
        - name: http
        port: 80
        targetPort: http


Test Endpoints:
    # Process payment (idempotent)
    curl -X POST http://localhost:3003/payments \
    -H "Authorization: Bearer JWT_TOKEN" \
    -H "Idempotency-Key: unique-key-123" \
    -H "Content-Type: application/json" \
    -d '{
        "order_id": 1,
        "amount": 500,
        "method": "credit_card"
    }'

    # Get payment status
    curl http://localhost:3003/payments/1 \
    -H "Authorization: Bearer JWT_TOKEN"

    # Refund payment (admin)
    curl -X POST http://localhost:3003/payments/1/refund \
    -H "Authorization: Bearer ADMIN_JWT_TOKEN" \
    -H "Content-Type: application/json" \
    -d '{
        "reason": "Customer requested"
    }'

    # Reconciliation report
    curl "http://localhost:3003/reconciliation/report?start_date=2025-01-01&end_date=2025-12-31" \
    -H "Authorization: Bearer ADMIN_JWT_TOKEN"

    # Health check
    curl http://localhost:3003/health

    # Metrics
    curl http://localhost:3003/metrics


DataBase schema:
    CREATE TABLE payments (
        id SERIAL PRIMARY KEY,
        order_id INTEGER NOT NULL,
        user_id INTEGER NOT NULL,
        amount DECIMAL(10, 2) NOT NULL,
        method VARCHAR(50) NOT NULL,
        status VARCHAR(50) DEFAULT 'pending',
        fraud_reason VARCHAR(255),
        refund_reason TEXT,
        created_at TIMESTAMP DEFAULT NOW(),
        updated_at TIMESTAMP DEFAULT NOW()
    );

    CREATE INDEX idx_payments_user ON payments(user_id);
    CREATE INDEX idx_payments_order ON payments(order_id);
    CREATE INDEX idx_payments_status ON payments(status);
    CREATE INDEX idx_payments_created ON payments(created_at DESC);

